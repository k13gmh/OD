<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questions</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        h1 {
            text-align: center;
            margin-top: 20px;
        }

        .question-container {
            text-align: left;
            margin: 20px;
        }

        .question-number {
            font-weight: bold;
        }

        .answer-button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            background-color: white;
            cursor: pointer;
            font-size: 16px;
        }

        .answer-button.selected {
            background-color: grey;
        }

        .answer-button:hover {
            background-color: #f1f1f1;
        }

        #next-button {
            width: 100%;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
        }

        #next-button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        #score-container {
            margin-top: 20px;
            font-size: 18px;
            text-align: center;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Questions</h1>

    <div id="question-container" class="question-container">
        <img id="question-image" src="" alt="Question Image" style="width:100%; max-width:300px; display:block; margin:0 auto 20px; border:1px solid #ddd; border-radius:5px;">
        <p id="question-text">Loading...</p>

        <div id="answers-container">
            <!-- Answer choices will be inserted here -->
        </div>

        <button id="next-button" disabled>Next</button>
    </div>

    <div id="score-container">
        <p>Your score is <span id="score"></span> out of <span id="total-questions"></span></p>
    </div>

    <script>
        let questions = [];
        let currentIndex = 0;
        let selectedAnswers = [];
        let correctAnswers = 0;

        // Fetch questions and answers
        fetch('Questions/questions.txt')
            .then(response => response.text())
            .then(data => {
                questions = data.split('\n').map(line => {
                    const fields = line.split('-');
                    if (fields.length >= 3) {
                        return {
                            number: fields[0].trim(),
                            text: fields[2].trim()
                        };
                    }
                    return null;
                }).filter(Boolean);
                console.log('Questions loaded:', questions);
                displayQuestion();
            })
            .catch(error => {
                alert('Error loading questions.');
                console.log('Error fetching questions:', error);
            });

        // Display the current question
        function displayQuestion() {
            const questionTextElement = document.getElementById('question-text');
            const questionImageElement = document.getElementById('question-image');
            const nextButton = document.getElementById('next-button');
            const answersContainer = document.getElementById('answers-container');

            if (currentIndex < questions.length) {
                const question = questions[currentIndex];
                questionTextElement.innerHTML = `<span class="question-number">${question.number}</span> - ${question.text}`;
                questionImageElement.src = `Images/${question.number}.jpeg`;
                questionImageElement.alt = `Image for Question ${question.number}`;

                // Load answers for the current question
                fetch('Questions/Answers.txt')
                    .then(response => response.text())
                    .then(data => {
                        const answers = data.split('\n').map(line => {
                            const fields = line.split('-');
                            if (fields[0].trim() === question.number) {
                                return {
                                    letter: fields[1].trim(),
                                    text: fields[2].trim()
                                };
                            }
                            return null;
                        }).filter(Boolean);

                        console.log('Answers for question', question.number, answers);

                        // Add answer buttons dynamically
                        answersContainer.innerHTML = ''; // Clear previous answers
                        answers.forEach(answer => {
                            const button = document.createElement('button');
                            button.classList.add('answer-button');
                            button.innerHTML = `${answer.letter}: ${answer.text}`;
                            button.addEventListener('click', () => selectAnswer(answer.letter));
                            answersContainer.appendChild(button);
                        });

                        nextButton.disabled = false;
                    })
                    .catch(error => {
                        alert('Error loading answers.');
                        console.log('Error fetching answers:', error);
                    });
            } else {
                questionTextElement.textContent = 'No more questions!';
                questionImageElement.style.display = 'none';
                nextButton.disabled = true;
                displayScore();
            }
        }

        // Select an answer
        function selectAnswer(answerLetter) {
            const answerButtons = document.querySelectorAll('.answer-button');
            answerButtons.forEach(button => button.classList.remove('selected'));

            const selectedButton = Array.from(answerButtons).find(button => button.innerHTML.startsWith(answerLetter));
            if (selectedButton) {
                selectedButton.classList.add('selected');
            }

            selectedAnswers[currentIndex] = answerLetter;
            console.log(`Selected answer for question ${currentIndex + 1}: ${answerLetter}`);
        }

        // Move to the next question
        document.getElementById('next-button').addEventListener('click', () => {
            currentIndex++;
            displayQuestion();
        });

        // Display the score at the end
        function displayScore() {
            fetch('Questions/Solutions.txt')
                .then(response => response.text())
                .then(data => {
                    const solutions = data.split('\n').map(line => {
                        const fields = line.split('-');
                        if (fields.length >= 4) {
                            return {
                                questionNumber: fields[0].trim(),
                                correctAnswer: fields[2].trim(),
                                explanation: fields[3].trim()
                            };
                        }
                        return null;
                    }).filter(Boolean);

                    console.log('Solutions loaded:', solutions);

                    // Compare answers and calculate score
                    correctAnswers = 0;
                    solutions.forEach(solution => {
                        const userAnswer = selectedAnswers.find((answer, index) => questions[index].number === solution.questionNumber);
                        if (userAnswer === solution.correctAnswer) {
                            correctAnswers++;
                        }
                    });

                    // Show score and total questions
                    const scoreContainer = document.getElementById('score-container');
                    const scoreElement = document.getElementById('score');
                    const totalQuestionsElement = document.getElementById('total-questions');

                    scoreElement.textContent = correctAnswers;
                    totalQuestionsElement.textContent = questions.length;

                    scoreContainer.style.display = 'block';
                })
                .catch(error => {
                    console.error('Error loading solutions:', error);
                });
        }
    </script>
</body>
</html>
