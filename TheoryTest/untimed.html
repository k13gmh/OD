<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Theory Test - No Timer</title>
    <style>
        body {
            font-family: -apple-system, sans-serif;
            background-color: #000;
            color: #e0e0e0;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
            justify-content: center;
            height: 100vh;
        }
        #test-ui {
            width: 100%;
            max-width: 600px;
            text-align: center;
            display: none;
        }
        .loading-text {
            color: #007bff;
            font-size: 1.2rem;
            font-weight: bold;
        }
        .v-tag {
            position: fixed;
            bottom: 10px;
            right: 15px;
            font-family: monospace;
            font-size: 0.6rem;
            color: #333;
        }
    </style>
</head>
<body>

    <div id="status-message" class="loading-text">Verifying Access...</div>

    <div id="test-ui">
        <h1>Theory Test - No Timer</h1>
        <div id="content-area">
            <p>Questions Loaded. System Active.</p>
        </div>
    </div>

    <span class="v-tag">v1.5.1</span>

    <script>
        /**
         * Ver 1.5.1
         * This app checks for a valid 'gatekeeper_stamp' set by the Main Menu.
         * It does not calculate the code itself.
         */

        async function init() {
            const status = document.getElementById('status-message');
            
            // 1. Generate the current month-year string to check against
            const now = new Date();
            const currentMonthYear = (now.getUTCMonth() + 1) + "-" + now.getUTCFullYear();
            
            // 2. Retrieve the stamp from the Main Menu's unlock process
            const savedStamp = localStorage.getItem('gatekeeper_stamp');

            if (savedStamp === currentMonthYear) {
                // Access is valid for this month
                try {
                    status.innerText = "Loading Questions...";
                    
                    // Fetch the questions (This only happens if access is confirmed)
                    const response = await fetch('questions.json');
                    if (!response.ok) throw new Error("File not found");
                    
                    const data = await response.json();
                    localStorage.setItem('questions_json', JSON.stringify(data));
                    
                    launchTest(data);
                } catch (e) {
                    status.innerText = "Error: questions.json missing.";
                    console.error(e);
                }
            } else {
                // Access denied or expired
                status.innerText = "Access Expired. Redirecting to Menu...";
                setTimeout(() => {
                    window.location.href = "index.html"; // Replace with your actual menu filename
                }, 2000);
            }
        }

        function launchTest(data) {
            document.getElementById('status-message').style.display = 'none';
            document.getElementById('test-ui').style.display = 'block';
            
            // Your rendering logic goes here
            console.log("Theory Test Engine Started with", data.length, "questions.");
        }

        window.onload = init;
    </script>
</body>
</html>
