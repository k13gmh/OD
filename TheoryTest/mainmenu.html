<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orion Drive - Main Menu</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background-color: #f4f7f9; 
            color: #333; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh; 
            margin: 0; 
            padding: 20px;
        }
        .container { width: 100%; max-width: 400px; text-align: center; }
        .logo { font-size: 2.5rem; font-weight: bold; color: #007bff; margin-bottom: 10px; }
        .subtitle { color: #7f8c8d; margin-bottom: 30px; }
        
        .card { 
            background: #fff; 
            padding: 25px; 
            border-radius: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            border: 1px solid #e1e8ed; 
            margin-bottom: 20px;
        }

        .input-group { margin-bottom: 20px; text-align: left; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; color: #444; }
        input { 
            width: 100%; 
            padding: 14px; 
            border-radius: 10px; 
            border: 1px solid #d1e3f8; 
            font-size: 1.1rem; 
            box-sizing: border-box;
            text-align: center;
            letter-spacing: 2px;
        }

        .btn { 
            width: 100%; 
            background: #007bff; 
            color: #fff; 
            border: none; 
            padding: 18px; 
            border-radius: 12px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 1rem; 
            text-transform: uppercase; 
            margin-bottom: 12px;
            transition: background 0.2s;
        }
        .btn-secondary { background: #bdc3c7; color: #444; }
        .btn:disabled { background: #dfe6e9; cursor: not-allowed; }

        #auth-section { display: block; }
        #menu-section { display: none; }

        .v-tag { position: fixed; bottom: 8px; right: 12px; font-family: monospace; font-size: 0.65rem; color: #bdc3c7; }
    </style>
</head>
<body>

    <div class="container">
        <div class="logo">ORION DRIVE</div>
        <p class="subtitle">Theory Test Training</p>

        <div id="auth-section" class="card">
            <div class="input-group">
                <label>Enter Student Access Code</label>
                <input type="text" id="access-code" placeholder="0000" maxlength="4">
            </div>
            <button class="btn" onclick="validateCode()">Unlock Tests</button>
        </div>

        <div id="menu-section">
            <div class="card">
                <button class="btn" onclick="launchTest('untimed.html')">Untimed Practice</button>
                <button class="btn btn-secondary" onclick="launchTest('timed.html')">Timed Mock Test</button>
                <button class="btn btn-secondary" disabled>Category Filter (Soon)</button>
            </div>
            <button class="btn btn-secondary" onclick="logout()">Change Access Code</button>
        </div>
    </div>

    <span class="v-tag">v1.9.0</span>

    <script>
        const APP_VERSION = "1.9.0";

        // Check if already logged in on load
        window.onload = function() {
            const savedExpiry = localStorage.getItem('orion_auth_expiry');
            if (savedExpiry && !isExpired(savedExpiry)) {
                showMenu();
            }
        };

        function validateCode() {
            const codeInput = document.getElementById('access-code').value;
            
            // Your math logic here: (MM + YY) * 11
            const now = new Date();
            const mm = now.getMonth() + 1;
            const yy = now.getFullYear() % 100;
            const expectedCode = (mm + yy) * 11;

            if (parseInt(codeInput) === expectedCode) {
                const expiryString = yy.toString() + mm.toString().padStart(2, '0');
                localStorage.setItem('orion_auth_expiry', expiryString);
                showMenu();
            } else {
                alert("Invalid Access Code for the current month.");
            }
        }

        function isExpired(expiryStr) {
            const now = new Date();
            const currentYYMM = (now.getFullYear() % 100).toString() + 
                                (now.getMonth() + 1).toString().padStart(2, '0');
            return parseInt(currentYYMM) > parseInt(expiryStr);
        }

        function showMenu() {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('menu-section').style.display = 'block';
        }

        function logout() {
            localStorage.removeItem('orion_auth_expiry');
            location.reload();
        }

        // ENFORCED GATEKEEPER LOGIC
        function launchTest(filename) {
            // Check expiry again just in case
            const expiry = localStorage.getItem('orion_auth_expiry');
            if (!expiry || isExpired(expiry)) {
                alert("Session expired. Please re-enter code.");
                logout();
                return;
            }

            // Set the one-time launch token
            localStorage.setItem('orion_launch_token', 'active');
            
            // Redirect to the chosen test
            window.location.href = filename;
        }
    </script>
</body>
</html>
