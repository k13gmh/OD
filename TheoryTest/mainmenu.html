<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orion Drive - Main Menu</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background-color: #f4f7f9; 
            color: #333; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh; 
            margin: 0; 
            padding: 20px;
        }
        .container { width: 100%; max-width: 400px; text-align: center; }
        .logo { font-size: 2.5rem; font-weight: bold; color: #007bff; margin-bottom: 10px; }
        .subtitle { color: #7f8c8d; margin-bottom: 30px; }
        
        .card { 
            background: #fff; 
            padding: 25px; 
            border-radius: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
            border: 1px solid #e1e8ed; 
            margin-bottom: 20px;
        }

        .input-group { margin-bottom: 20px; text-align: left; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; color: #444; }
        input { 
            width: 100%; 
            padding: 14px; 
            border-radius: 10px; 
            border: 1px solid #d1e3f8; 
            font-size: 1.1rem; 
            box-sizing: border-box;
            text-align: center;
            letter-spacing: 2px;
        }

        .btn { 
            width: 100%; 
            background: #007bff; 
            color: #fff; 
            border: none; 
            padding: 18px; 
            border-radius: 12px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 1rem; 
            text-transform: uppercase; 
            margin-bottom: 12px;
            transition: background 0.2s;
        }
        .btn-secondary { background: #bdc3c7; color: #444; }
        
        /* Debug Styling */
        .debug-box { 
            margin-top: 20px; 
            font-family: monospace; 
            font-size: 0.75rem; 
            color: #d9534f; 
            background: #fff0f0; 
            padding: 10px; 
            border-radius: 10px;
            border: 1px dashed #d9534f;
        }

        #auth-section { display: block; }
        #menu-section { display: none; }

        .v-tag { position: fixed; bottom: 8px; right: 12px; font-family: monospace; font-size: 0.65rem; color: #bdc3c7; }
    </style>
</head>
<body>

    <div class="container">
        <div class="logo">ORION DRIVE</div>
        <p class="subtitle">Theory Test Training</p>

        <div id="auth-section" class="card">
            <div class="input-group">
                <label>Enter Student Access Code</label>
                <input type="number" id="access-code" placeholder="00000" maxlength="5">
            </div>
            <button class="btn" onclick="validateCode()">Unlock Tests</button>
            
            <div class="debug-box">
                DEBUG: Expected Code for 
                <span id="debug-date"></span> is 
                <span id="debug-code" style="font-weight:bold; font-size: 1rem;"></span>
            </div>
        </div>

        <div id="menu-section">
            <div class="card">
                <button class="btn" onclick="launchTest('untimed.html')">Untimed Practice</button>
                <button class="btn btn-secondary" onclick="launchTest('timed.html')">Timed Mock Test</button>
                <button class="btn btn-secondary" style="opacity:0.5" disabled>Category Filter</button>
            </div>
            <button class="btn btn-secondary" onclick="logout()">Change Access Code</button>
        </div>
    </div>

    <span class="v-tag">v1.9.1</span>

    <script>
        const APP_VERSION = "1.9.1";

        // Calculate expected values globally for debugging and validation
        const now = new Date();
        const mm = now.getMonth() + 1;
        const yy = now.getFullYear() % 100;
        const expectedCode = (mm + yy) * 11;

        window.onload = function() {
            // Fill Debug Info
            document.getElementById('debug-date').innerText = `${mm}/${yy}`;
            document.getElementById('debug-code').innerText = expectedCode;

            const savedExpiry = localStorage.getItem('orion_auth_expiry');
            if (savedExpiry && !isExpired(savedExpiry)) {
                showMenu();
            }
        };

        function validateCode() {
            const codeInput = document.getElementById('access-code').value;

            if (parseInt(codeInput) === expectedCode) {
                const expiryString = yy.toString() + mm.toString().padStart(2, '0');
                localStorage.setItem('orion_auth_expiry', expiryString);
                showMenu();
            } else {
                alert("Invalid Access Code. Check the debug box!");
            }
        }

        function isExpired(expiryStr) {
            const currentYYMM = yy.toString() + mm.toString().padStart(2, '0');
            return parseInt(currentYYMM) > parseInt(expiryStr);
        }

        function showMenu() {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('menu-section').style.display = 'block';
        }

        function logout() {
            localStorage.removeItem('orion_auth_expiry');
            location.reload();
        }

        function launchTest(filename) {
            const expiry = localStorage.getItem('orion_auth_expiry');
            if (!expiry || isExpired(expiry)) {
                alert("Session expired.");
                logout();
                return;
            }

            localStorage.setItem('orion_launch_token', 'active');
            window.location.href = filename;
        }
    </script>
</body>
</html>
