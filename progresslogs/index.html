<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driving Lesson Progress</title>
    <style>
        /* Your existing styles */
        input[readonly] {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <h1>Driving Lesson Progress Sheet</h1>
    <label for="userId">User ID:</label>
    <input type="text" id="userId" pattern="^[0-9]{4}[A-Za-z]{4}$" required>
    <button id="loginButton">Login</button>
    <br><br>
    <div id="progressSection" style="display:none;">
        <label for="lessonDate">Enter Date (DD/MM/YY):</label>
        <input type="text" id="lessonDate" placeholder="DD/MM/YY" required>
        <br><br>
        <label for="hours">Number of Hours:</label>
        <input type="number" id="hours" min="1" max="12" required>
        <br><br>
        <p><strong>E</strong>xplained <strong>H</strong>elped <strong>P</strong>rompted <strong>I</strong>ndependent <strong>R</strong>eflection</p>
        <table id="progressTable">
            <!-- Table headers and rows as per your structure -->
        </table>
        <br>
        <button id="saveButton">Save</button>
        <button id="clearButton">Clear</button>
    </div>
    <script>
        const userIdInput = document.getElementById('userId');
        const loginButton = document.getElementById('loginButton');
        const progressSection = document.getElementById('progressSection');
        const lessonDateInput = document.getElementById('lessonDate');
        const hoursInput = document.getElementById('hours');
        const saveButton = document.getElementById('saveButton');
        const clearButton = document.getElementById('clearButton');
        const progressTable = document.getElementById('progressTable');

        let currentUserId = null;
        let dataStore = JSON.parse(localStorage.getItem('progressData')) || {};

        loginButton.addEventListener('click', () => {
            const userId = userIdInput.value.trim();
            if (/^[0-9]{4}[A-Za-z]{4}$/.test(userId)) {
                currentUserId = userId;
                progressSection.style.display = 'block';
                userIdInput.disabled = true;
                loginButton.disabled = true;
                loadProgress();
            } else {
                alert('Invalid User ID format. Please enter 4 numbers followed by 4 letters.');
            }
        });

        function loadProgress() {
            const date = lessonDateInput.value.trim();
            if (currentUserId && date) {
                const formattedDate = formatDateForStorage(date);
                if (dataStore[currentUserId] && dataStore[currentUserId][formattedDate]) {
                    const progressData = dataStore[currentUserId][formattedDate];
                    // Populate the table with progressData
                    // Set hours input and make it read-only
                    hoursInput.value = progressData.hours;
                    hoursInput.readOnly = true;
                } else {
                    // Clear the table and reset hours input
                    hoursInput.value = '';
                    hoursInput.readOnly = false;
                }
            }
        }

        saveButton.addEventListener('click', () => {
            const date = lessonDateInput.value.trim();
            const hours = hoursInput.value.trim();
            if (!date || !hours) {
                alert('Please enter both date and number of hours.');
                return;
            }
            const formattedDate = formatDateForStorage(date);
            if (!dataStore[currentUserId]) {
                dataStore[currentUserId] = {};
            }
            if (!dataStore[currentUserId][formattedDate]) {
                dataStore[currentUserId][formattedDate] = {
                    hours: hours,
                    progress: {} // Collect progress data from the table
                };
                localStorage.setItem('progressData', JSON.stringify(dataStore));
                alert('Progress saved successfully.');
                hoursInput.readOnly = true;
            } else {
                alert('Progress for this date already exists.');
            }
        });

        clearButton.addEventListener('click', () => {
            // Clear the table inputs
        });

        function formatDateForStorage(date) {
            const [day, month, year] = date.split('/');
            return `20${year}-${month}-${day}`; // Converts DD/MM/YY to YYYY-MM-DD
        }

        lessonDateInput.addEventListener('change', loadProgress);
    </script>
</body>
</html>
