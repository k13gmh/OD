<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Driving Lesson Progress</title>
    <style>
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 5px;
            text-align: center;
        }
        th, td {
            width: 100px;
        }
        input[readonly] {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <h1>Driving Lesson Progress Sheet</h1>
    <label for="userId">User ID:</label>
    <input type="text" id="userId" pattern="^[0-9]{4}[A-Za-z]{4}$" required>
    <button id="loginButton">Login</button>
    <br><br>
    <div id="progressSection" style="display:none;">
        <label for="lessonDate">Enter Date:</label>
        <input type="date" id="lessonDate" required>
        <br><br>
        <label for="hours">Number of Hours:</label>
        <input type="number" id="hours" min="1" max="12" required>
        <br><br>
        <p><strong>E</strong>xplained <strong>H</strong>elped <strong>P</strong>rompted <strong>I</strong>ndependent <strong>R</strong>eflection</p>
        <table id="progressTable">
            <thead>
                <tr>
                    <th>Description</th>
                    <th>E</th>
                    <th>H</th>
                    <th>P</th>
                    <th>I</th>
                    <th>R</th>
                </tr>
            </thead>
            <tbody>
                <!-- Rows will be generated by JavaScript -->
            </tbody>
        </table>
        <br>
        <button id="saveButton">Save</button>
        <button id="clearButton">Clear</button>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const userIdInput = document.getElementById('userId');
            const loginButton = document.getElementById('loginButton');
            const progressSection = document.getElementById('progressSection');
            const lessonDateInput = document.getElementById('lessonDate');
            const hoursInput = document.getElementById('hours');
            const saveButton = document.getElementById('saveButton');
            const clearButton = document.getElementById('clearButton');
            const progressTable = document.getElementById('progressTable').getElementsByTagName('tbody')[0];

            let currentUserId = null;
            let dataStore = JSON.parse(localStorage.getItem('progressData')) || {};

            // Generate table rows
            for (let i = 1; i <= 27; i++) {
                const row = progressTable.insertRow();
                const cellDescription = row.insertCell(0);
                cellDescription.textContent = `Row ${i.toString().padStart(2, '0')}`;
                for (let j = 1; j <= 5; j++) {
                    const cell = row.insertCell(j);
                    cell.addEventListener('click', () => {
                        cell.textContent = cell.textContent === 'X' ? '' : 'X';
                    });
                }
            }

            loginButton.addEventListener('click', () => {
                const userId = userIdInput.value.trim();
                if (/^[0-9]{4}[A-Za-z]{4}$/.test(userId)) {
                    currentUserId = userId;
                    progressSection.style.display = 'block';
                    userIdInput.disabled = true;
                    loginButton.disabled = true;
                } else {
                    alert('Invalid User ID format. Please enter 4 numbers followed by 4 letters.');
                }
            });

            lessonDateInput.addEventListener('change', () => {
                if (currentUserId) {
                    loadProgress();
                }
            });

            function loadProgress() {
                const date = lessonDateInput.value;
                if (currentUserId && date) {
                    if (dataStore[currentUserId] && dataStore[currentUserId][date]) {
                        const progressData = dataStore[currentUserId][date];
                        hoursInput.value = progressData.hours;
                        hoursInput.readOnly = true;
                        // Populate the table with progressData
                        progressData.progress.forEach((row, rowIndex) => {
                            row.forEach((cell, cellIndex) => {
                                progressTable.rows[rowIndex].cells[cellIndex + 1].textContent = cell;
                            });
                        });
                    } else {
                        // Clear the table and reset hours input
                        hoursInput.value = '';
                        hoursInput.readOnly = false;
                        clearTable();
                    }
                }
            }

            function clearTable() {
                for (let i = 0; i < progressTable.rows.length; i++) {
                    for (let j = 1; j < progressTable.rows[i].cells.length; j++) {
                        progressTable.rows[i].cells[j].textContent = '';
                    }
                }
            }

            saveButton.addEventListener('click', () => {
                const date = lessonDateInput.value;
                const hours = hoursInput.value.trim();
                if (!date || !hours) {
                    alert('Please enter both date and number of hours.');
                    return;
                }
                if (!dataStore[currentUserId]) {
                    dataStore[currentUserId] = {};
                }
                if (!dataStore[currentUserId][date]) {
                    const progress = [];
                    for (let i = 0; i < progressTable.rows.length; i++) {
                        const row = [];
                        for (let j = 1; j < progressTable.rows[i].cells.length; j++) {
                            row.push(progressTable.rows[i].cells[j].textContent);
                        }
                        progress.push(row);
                    }
                    dataStore[currentUserId][date] = {
                        hours: hours,
                        progress: progress
                    };
                    localStorage.setItem('progressData', JSON.stringify(dataStore));
                    alert('Progress saved successfully.');
                    hoursInput.readOnly = true;
                } else {
                    alert('Progress for this date already exists. Please select a different date.');
                }
            });

            clearButton.addEventListener('click', () => {
                clearTable();
            });
        });
    </script>
</body>
</html>
