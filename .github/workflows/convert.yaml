name: Convert
on:
  workflow_dispatch:

# This section is the "Key" that allows the script to write the file
permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          ref: TheoryTest  # Go to your specific branch

      - name: Run Python
        shell: python
        run: |
          import json, csv
          qs = []
          # If this fails, it's usually because the file isn't named exactly 'questions.txt'
          with open('questions.txt', 'r', encoding='utf-8') as f:
              for r in csv.reader(f):
                  if len(r) < 9: continue
                  qs.append({
                      "id": r[0],
                      "category": r[1],
                      "question": r[2],
                      "choices": {"A": r[3], "B": r[4], "C": r[5], "D": r[6]},
                      "correct": r[7],
                      "explanation": r[8]
                  })
          with open('questions.json', 'w', encoding='utf-8') as f:
              json.dump(qs, f, indent=2)

      - name: Push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add questions.json
          git commit -m "Auto-generated JSON"
          git push origin TheoryTest
